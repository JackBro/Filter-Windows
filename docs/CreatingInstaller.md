# Installer Creation Notes



There's some issues due to binding redirects and other fun stuff in recent .NET versions (esp when using .NET core projects, like the new engine).

When creating a new MSI installer project, and adding the "Project Output" to the installer file system, Visual Studio will attempt to resolve neccessary dependencies.
Unfortunately this appears to conflict with the binding redirects auto generated by the various projects. The installer project will bundle in wrong binary versions.

So, here's the hack to make it work:  

 1. Add "Project Output" from GUI project.
 2. Add "Project Output" from Service project.
 3. Go through every single resolved dependency (you can mass-select first time), right click on them in the properties panel, and click "Exclude".
 4. Go through the file system in the installer project and manually delete all of the resolved dependencies, aka any DLL's left over after the exclusion step.
 5. Right click in the installer file system. Click Add->File.
 6. Browse to the GUI project (after building of course) bin directory. Make sure you have the ARCH correct (Release x64/Release x86).
 7. Select every single DLL file, and click "OK" to include all DLL files.
 8. Go through your resolved dependencies in the properties panel again. You will see, scattered amid a huge list of excluded dependencies, some newly resolved ones. Make sure they are all excluded.
 9. Again, go to Add->File. Browse back to the appropriate GUI directory.
 10. Select all `.config` files and ensure they are added. **you need these because .NET prints binding redirects parsed at runtime into these files with every new build. You must refresh them if you modify your build or dependencies in any way.**
 11. Right click on the installer project solution, click "Rebuild", not "Build".
 
 ### IF BUILDING 64 BIT INSTALLER
 12. Open Orca, drop the new `.msi` file in to it to open it.
 13. Find the "Binary" table.
 14. In the "Binary" table, find the "InstallUtil" property and double click the "Data" cell to edit it.
 15. From the now-open file dialog, browse to and select `C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtilLib.dll` and click "Open".
 16. Ensure that "Read binary from filename" is selected.
 17. Click OK, then click save or ctrl+s to save these changes to the MSI file. **This entire process is necessary in order for the MSI to execute the custom actions we use to start up the GUI and spawn the server when installation is complete.** Without doing this, the installer would fail with a bad format exception, because unmodified, it is unable to execute/launch a 64 bit process.
